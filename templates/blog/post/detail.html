{% extends 'blog/parent/base.html' %}
{% load static %}

{% block head %}
    <link rel="stylesheet" type="text/css" href="{% static 'css/detail.css' %}">
    <script src="{% static 'javascript/detail.js' %}"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    {% block title %}{% endblock %}
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
{% endblock %}

{% block body %}
<div class="container">
    <div class="music-player">
        <img src="{{ post.image_file.url }}" alt="{{ post.title }}" style="border-radius: 40px">
        <div class="details">
            <h1>{{ post.title }}</h1>
            <p>{{ post.singer }}</p>
            <div class="audio-player">
                <audio id="audioPlayer">
                    <source src="{{ post.music_file.url }}" type="audio/mpeg">
                    مرورگر شما از تگ صوتی پشتیبانی نمی‌کند.
                </audio>
                <div class="progress-container">
                    <span class="progress-time" id="currentTime">0:00</span>
                    <div class="progress-bar" id="progressBar" onclick="seek(event)">
                        <div class="progress" id="progress"></div>
                    </div>
                    <span class="progress-time" id="durationTime">3:58</span>
                </div>
            </div>
            <div class="controls">
                <button onclick="seekBackward()"><i class="fas fa-forward"></i></button>
                <button id="playPauseBtn" onclick="playPause()"><i class="fas fa-play"></i></button>
                <button onclick="seekForward()"><i class="fas fa-backward"></i></button>
            </div>
        </div>
    </div>

    <div class="sub">
        <p>متن</p>
        {{ post.sub | linebreaks }}
    </div>
</div>
<script>
var audioPlayer = document.getElementById('audioPlayer');
var progress = document.getElementById('progress');
var progressBar = document.getElementById('progressBar');
var currentTimeElem = document.getElementById('currentTime');
var durationTimeElem = document.getElementById('durationTime');
var playPauseBtn = document.getElementById('playPauseBtn');
var isPlaying = false;

audioPlayer.addEventListener('timeupdate', updateProgress);
audioPlayer.addEventListener('loadedmetadata', function() {
    durationTimeElem.textContent = formatTime(audioPlayer.duration);
});

// Set initial state to paused
playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';

function playPause() {
    if (audioPlayer.paused || audioPlayer.ended) {
        audioPlayer.play();
        playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
    } else {
        audioPlayer.pause();
        playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
    }
    isPlaying = !audioPlayer.paused;
}

function updateProgress() {
    var percent = (audioPlayer.currentTime / audioPlayer.duration) * 100;
    progress.style.width = percent + '%';
    currentTimeElem.textContent = formatTime(audioPlayer.currentTime);
}

function seek(event) {
    var percent = event.offsetX / progressBar.offsetWidth;
    audioPlayer.currentTime = percent * audioPlayer.duration;
}

function seekBackward() {
    var newTime = audioPlayer.currentTime - 5;
    audioPlayer.currentTime = newTime < 0 ? 0 : newTime;
}

function seekForward() {
    var newTime = audioPlayer.currentTime + 5;
    audioPlayer.currentTime = newTime > audioPlayer.duration ? audioPlayer.duration : newTime;
}

function formatTime(seconds) {
    var minutes = Math.floor(seconds / 60);
    var seconds = Math.floor(seconds % 60);
    if (seconds < 10) {
        seconds = '0' + seconds;
    }
    return minutes + ':' + seconds;
}

</script>

{% endblock %}
